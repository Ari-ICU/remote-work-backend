generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String         @id @default(cuid())
  email             String         @unique
  password          String
  firstName         String
  lastName          String
  role              UserRole       @default(FREELANCER)
  avatar            String?
  bio               String?
  skills            String[]
  hourlyRate        Float?
  location          String?
  headline          String?
  website           String?
  github            String?
  linkedin          String?
  verified          Boolean        @default(false)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  languages         String[]       @default([])
  education         Json?
  experience        Json?
  resumeUrl         String?
  resumeTemplate    String?
  paymentProvider   String?
  paymentProviderId String?
  hasPaymentMethod  Boolean        @default(false)
  applications      Application[]
  jobsPosted        Job[]          @relation("JobPoster")
  receivedMessages  Message[]      @relation("MessageReceiver")
  sentMessages      Message[]      @relation("MessageSender")
  notifications     Notification[]
  payments          Payment[]
  reviews           Review[]       @relation("ReviewReceiver")
  givenReviews      Review[]       @relation("ReviewGiver")
  sessions          Session[]

  @@map("users")
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token        String   @unique // This is the refreshToken
  accessToken  String?  @unique // New field for accessToken
  userAgent    String?
  ipAddress    String?
  isValid      Boolean  @default(true)
  expiresAt    DateTime
  createdAt    DateTime @default(now())

  @@index([userId])
  @@map("sessions")
}

model QrSession {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String?
  isUsed    Boolean  @default(false)
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@map("qr_sessions")
}

model Job {
  id                String        @id @default(cuid())
  title             String
  description       String
  category          String
  skills            String[]
  budget            Float
  budgetType        String
  duration          String?
  status            JobStatus     @default(DRAFT)
  location          String?
  remote            Boolean       @default(true)
  aiMatchScore      Float?
  aiTags            String[]
  responsibilities  String[]      @default([])
  requirements      String[]      @default([])
  posterId          String
  companyName       String?
  hiredFreelancerId String?
  paymentRequired   Boolean       @default(true)
  featured          Boolean       @default(false)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  applications      Application[]
  poster            User          @relation("JobPoster", fields: [posterId], references: [id])

  @@index([posterId])
  @@index([status])
  @@index([category])
  @@map("jobs")
}

model Application {
  id               String            @id @default(cuid())
  coverLetter      String
  proposedRate     Float
  estimatedTime    String?
  status           ApplicationStatus @default(PENDING)
  aiMatchScore     Float?
  aiRecommendation String?
  jobId            String
  applicantId      String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  applicant        User              @relation(fields: [applicantId], references: [id])
  job              Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([jobId, applicantId])
  @@index([jobId])
  @@index([applicantId])
  @@map("applications")
}

model Message {
  id         String   @id @default(cuid())
  content    String
  type       String   @default("TEXT")
  fileUrl    String?
  read       Boolean  @default(false)
  senderId   String
  receiverId String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
  receiver   User     @relation("MessageReceiver", fields: [receiverId], references: [id])
  sender     User     @relation("MessageSender", fields: [senderId], references: [id])

  @@index([senderId])
  @@index([receiverId])
  @@map("messages")
}

model Payment {
  id                String        @id @default(cuid())
  amount            Float
  currency          String        @default("usd")
  status            PaymentStatus @default(PENDING)
  provider          String        @default("CARD")
  providerPaymentId String?       @unique
  paymentMethod     String?
  userId            String
  jobId             String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  user              User          @relation(fields: [userId], references: [id])

  @@index([userId])
  @@map("payments")
}

model Review {
  id         String   @id @default(cuid())
  rating     Int
  comment    String?
  reviewerId String
  revieweeId String
  createdAt  DateTime @default(now())
  reviewee   User     @relation("ReviewReceiver", fields: [revieweeId], references: [id])
  reviewer   User     @relation("ReviewGiver", fields: [reviewerId], references: [id])

  @@index([reviewerId])
  @@index([revieweeId])
  @@map("reviews")
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  message   String
  type      String   @default("SYSTEM")
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("notifications")
}

model PricingPlan {
  id          String   @id @default(cuid())
  name        String   @unique
  price       Float
  description String
  features    String[]
  highlight   Boolean  @default(false)
  cta         String
  badge       String?
  href        String
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("pricing_plans")
}

model SalaryCategory {
  id        String       @id @default(cuid())
  name      String       @unique
  order     Int          @default(0)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  roles     SalaryRole[]

  @@map("salary_categories")
}

model SalaryRole {
  id         String         @id @default(cuid())
  title      String
  range      String
  experience String
  categoryId String
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt
  category   SalaryCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@map("salary_roles")
}

model SalaryInsight {
  id          String   @id @default(cuid())
  icon        String
  title       String
  description String
  color       String
  bg          String
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("salary_insights")
}

model HiringSolution {
  id          String   @id @default(cuid())
  icon        String
  title       String
  description String
  features    String[]
  color       String
  bg          String
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("hiring_solutions")
}

model HiringStat {
  id        String   @id @default(cuid())
  label     String
  value     String
  icon      String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("hiring_stats")
}

model HiringPlan {
  id          String   @id @default(cuid())
  name        String   @unique
  price       String
  period      String
  description String
  features    String[]
  cta         String
  popular     Boolean  @default(false)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("hiring_plans")
}

model EmployerResourceCategory {
  id          String   @id @default(cuid())
  icon        String
  title       String
  description String
  resources   String[]
  color       String
  bg          String
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("employer_resource_categories")
}

model EmployerFeaturedGuide {
  id          String   @id @default(cuid())
  title       String
  description String
  category    String
  readTime    String
  icon        String
  color       String
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("employer_featured_guides")
}

model EmployerDownloadableResource {
  id          String   @id @default(cuid())
  title       String
  description String
  format      String
  size        String
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("employer_downloadable_resources")
}

model EmployerFAQ {
  id        String   @id @default(cuid())
  question  String
  answer    String
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("employer_faqs")
}

model SystemSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("system_settings")
}

enum UserRole {
  FREELANCER
  EMPLOYER
  ADMIN
}

enum JobStatus {
  DRAFT
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}
